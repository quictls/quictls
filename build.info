# Note that some of these directories are filtered in Configure.  Look for
# %skipdir there for further explanations.

SUBDIRS=crypto ssl apps util tools fuzz providers doc
IF[{- !$disabled{tests} -}]
  SUBDIRS=test
ENDIF
IF[{- !$disabled{'deprecated-3.0'} -}]
  SUBDIRS=engines
ENDIF
SUBDIRS=exporters

LIBS=libcrypto libssl
INCLUDE[libcrypto]=. include
INCLUDE[libssl]=. include
DEPEND[libssl]=libcrypto

# Empty DEPEND "indices" means the dependencies are expected to be built
# unconditionally before anything else.
DEPEND[]=include/openssl/asn1.h \
         include/openssl/asn1t.h \
         include/openssl/bio.h \
         include/openssl/cmp.h \
         include/openssl/cms.h \
         include/openssl/conf.h \
         include/openssl/crmf.h \
         include/openssl/crypto.h \
         include/openssl/ct.h \
         include/openssl/err.h \
         include/openssl/ess.h \
         include/openssl/lhash.h \
         include/openssl/ocsp.h \
         include/openssl/pkcs12.h \
         include/openssl/pkcs7.h \
         include/openssl/safestack.h \
         include/openssl/ssl.h \
         include/openssl/ui.h \
         include/openssl/x509.h \
         include/openssl/x509v3.h \
         include/openssl/x509_vfy.h \
         include/crypto/dso_conf.h

# I would rather these are just foo.gen, but I cannot figure out how
# Configurations/unix-Makefile.tmpl does its work with file extensions.
# Oh well, this goes away when we move to cmake
GENERATE[include/openssl/asn1.h]=include/openssl/asn1.h.gen
GENERATE[include/openssl/asn1t.h]=include/openssl/asn1t.h.gen
GENERATE[include/openssl/bio.h]=include/openssl/bio.h.gen
GENERATE[include/openssl/cmp.h]=include/openssl/cmp.h.gen
GENERATE[include/openssl/cms.h]=include/openssl/cms.h.gen
GENERATE[include/openssl/conf.h]=include/openssl/conf.h.gen
GENERATE[include/openssl/crmf.h]=include/openssl/crmf.h.gen
GENERATE[include/openssl/crypto.h]=include/openssl/crypto.h.gen
GENERATE[include/openssl/ct.h]=include/openssl/ct.h.gen
GENERATE[include/openssl/err.h]=include/openssl/err.h.gen
GENERATE[include/openssl/ess.h]=include/openssl/ess.h.gen
GENERATE[include/openssl/lhash.h]=include/openssl/lhash.h.gen
GENERATE[include/openssl/ocsp.h]=include/openssl/ocsp.h.gen
GENERATE[include/openssl/pkcs12.h]=include/openssl/pkcs12.h.gen
GENERATE[include/openssl/pkcs7.h]=include/openssl/pkcs7.h.gen
GENERATE[include/openssl/safestack.h]=include/openssl/safestack.h.gen
GENERATE[include/openssl/ssl.h]=include/openssl/ssl.h.gen
GENERATE[include/openssl/ui.h]=include/openssl/ui.h.gen
GENERATE[include/openssl/x509.h]=include/openssl/x509.h.gen
GENERATE[include/openssl/x509v3.h]=include/openssl/x509v3.h.gen
GENERATE[include/openssl/x509_vfy.h]=include/openssl/x509_vfy.h.gen


# include/openssl/configuration.h is generated by configdata.pm
# We still need this information for the FIPS module checksum, but the attribute
# 'skip' ensures that nothing is actually done with it.
GENERATE[include/openssl/configuration.h]{skip}=include/openssl/configuration.h.in
GENERATE[include/crypto/dso_conf.h]=include/crypto/dso_conf.h.in

IF[{- defined $target{shared_defflag} -}]
  SHARED_SOURCE[libcrypto]=libcrypto.ld
  SHARED_SOURCE[libssl]=libssl.ld

  GENERATE[libcrypto.ld]=util/libcrypto.num libcrypto
  GENERATE[libssl.ld]=util/libssl.num libssl
  DEPEND[libcrypto.ld libssl.ld]=configdata.pm util/perl/OpenSSL/Ordinals.pm
ENDIF

IF[{- $config{target} =~ /^(?:Cygwin|mingw|VC-)/ -}]
  GENERATE[libcrypto.rc]=util/mkrc.pl libcrypto
  GENERATE[libssl.rc]=util/mkrc.pl libssl
  DEPEND[libcrypto.rc libssl.rc]=configdata.pm

  SHARED_SOURCE[libcrypto]=libcrypto.rc
  SHARED_SOURCE[libssl]=libssl.rc
ENDIF

# This file sets the build directory up for pkg-config
GENERATE[libcrypto.pc]{exporter=pkg-config}=exporters/libcrypto.pc.in
DEPEND[libcrypto.pc]=builddata.pm
GENERATE[libssl.pc]{exporter=pkg-config}=exporters/libssl.pc.in
DEPEND[libssl.pc]=builddata.pm
GENERATE[openssl.pc]{exporter=pkg-config}=exporters/openssl.pc.in
DEPEND[openssl.pc]=builddata.pm
DEPEND[openssl.pc]=libcrypto.pc libssl.pc

GENERATE[builddata.pm]=exporters/mkinstalldata.pl \
    PREFIX=. BINDIR=apps LIBDIR= INCLUDEDIR=include APPLINKDIR=ms \
    ENGINESDIR=engines MODULESDIR=providers \
    "VERSION=$(VERSION)" "LDLIBS=$(LIB_EX_LIBS)"

DEPEND[""]=openssl.pc
